<html>
<head>
<title>A: Introduction, C Language</title>
<link href='notes.css' rel='stylesheet' type='text/css'>
</head>
<body>
<p><span class='title'>A: Introduction, C Language</span><p>
<p><hr><p>
<table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><span class='section'>Course Introduction</span></td><td align='right'></td></tr></table>
<p>
<p><hr><p>
<table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><span class='heading'>COMP1521 18s1<br>Computer Systems Fundamentals</span></td><td align='right'><small>2/74</small></td></tr></table>
<p>
<p><div class='center'>
<img alt="[Diagram:Pics/intro/chip0-small.jpg]" src="Pics/intro/chip0-small.jpg">
</div><p>
<div class='center'>
LiC: &nbsp; John Shepherd, &nbsp;&nbsp;&nbsp; Admin: Wael Alghamdi
</div>
<p><hr><p>
<table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><span class='heading'>Course Staff</span></td><td align='right'><small>3/74</small></td></tr></table>
<p>
The Cast <small>(of thousands)</small>:
<ul>
<li> Convenor: John Shepherd
<li> Course Admin: Wael Alghamdi
<li> Tutors: <br>
<span style="font-size:90%">
<nobr>Louis Cheung,</nobr>
<nobr>Matthew Gibson,</nobr>
<nobr>Alexander Hinds,</nobr>
<nobr>Aydin Itil,</nobr>
<nobr>Jashank Jeremy,</nobr>
<nobr>Thomas Kilkelly,</nobr>
<nobr>Daniel Li,</nobr>
<nobr>Alex Nendick,</nobr>
<nobr>Leon Nguyen,</nobr>
<nobr>Kevin Ni,</nobr>
<nobr>Ellen Oates,</nobr>
<nobr>Shanush Prema Thasarathan,</nobr>
<nobr>Minjie Shen</nobr>
</span>
<li> Lab assistants:<br>
<span style="font-size:90%">
<nobr>Caspian Baska,</nobr>
<nobr>Dylan Brotherston,</nobr>
<nobr>Jason Chu,</nobr>
<nobr>Jesse Colville,</nobr>
<nobr>Junjie Lei,</nobr>
<nobr>Oliver Richards,</nobr>
<nobr>Harrison Scott,</nobr>
<nobr>Simon Shields,</nobr>
<nobr>James Ye,</nobr>
<nobr>Michael Yoo</nobr>
</span>
</ul>
<p><hr><p>
<table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><span class='heading'>COMP1521 on the Web</span></td><td align='right'><small>4/74</small></td></tr></table>
<p>
Primary entry point is Webcms3
<p>
&nbsp;&nbsp; <a target="_blank" href="http://webcms3.cse.unsw.edu.au/COMP1521/18s1/">http://webcms3.cse.unsw.edu.au/COMP1521/18s1/</a>
<p>
Most of the <i>content</i> lives under
<p>
&nbsp;&nbsp; <font color='#000099'>/home/cs1521/web/18s1/... </font> &nbsp;&nbsp; <small>(e.g.lecs,labs,tutes,...)</small>
<p>
Most content is web-accessible via
<p>
&nbsp;&nbsp; <a target="_blank" href="http://cgi.cse.unsw.edu.au/~cs1521/18s1/index.php">http://cgi.cse.unsw.edu.au/~cs1521/18s1/index.php</a>
<p><hr><p>
<table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><span class='cont'>... COMP1521 on the Web</span></td><td align='right'><small>5/74</small></td></tr></table>
<p>
Most material on Webcms3 is publically readable.
<p>
Login to Webcms3 is via zID/zPass, and is needed for
<ul>
<li> quizzes, polls, comments/forums, forming groups, ...
</ul>
&nbsp;<br>
Submit work via <large><code>give</code></large> &nbsp; <small>(on cmd line or via Webcms3)</small>
<p>
Check marks via <large><code>sturec</code></large> &nbsp; <small>(on cmd line or via Webcms3)</small>
<p>&nbsp;<p>
For questions: use Webcms3 forum or email <large><code>cs1521@cse</code></large>
<p><hr><p>
<table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><span class='heading'>Me</span></td><td align='right'><small>6/74</small></td></tr></table>
<p>
Research:
<ul>
<li> information extraction, database systems, online learning
</ul>
Teaching:
<ul>
<li> UG: &nbsp;COMP{1921,1511,1521,2041,3311,4011}
<li> PG: &nbsp;COMP{9311,9315}, &nbsp; GSOE9010
</ul>
Admin:
<ul>
<li> Deputy Head of School (Education)
</ul>
<small>
Life:
<ul>
<li> Craft Beer, &nbsp;AFL, &nbsp;Craft Beer, &nbsp;K-Drama, &nbsp;Craft Beer, &nbsp;Nordic Noir, &nbsp;...
</ul>
</small>
<p><hr><p>
<table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><span class='heading'>You</span></td><td align='right'><small>7/74</small></td></tr></table>
<p>
Students in this course have completed:
<ul>
<li> COMP1511 or COMP1917 or COMP1911 <small>(maybe with bridging)</small>
</ul>
Everyone has learned <em>fundamental C programming</em>
<p>
COMP1511/1917 also studied <em>linked lists</em>, <em>ADTs</em> and <em>sorting</em>
<p>
Since not everyone has seen these, we won't use them
<p>
For this week ...
<ul>
<li> review/strengthen C knowledge
<li> introduce/revise core data structures &nbsp;<small>(stacks, queues)</small>
</ul>
<p><hr><p>
<table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><span class='heading'>Course Goals</span></td><td align='right'><small>8/74</small></td></tr></table>
<p>
COMP1511/1911/1917 ...
<ul>
<li> gets you thinking like a <em>programmer</em>
<li> solving problems by developing programs
<li> expressing your solution in the C language
</ul>
COMP1521 ...
<ul>
<li> gets you thinking like a <em>systems programmer</em>
<li> with a deep understanding of run-time behaviour
<li> and better able to reason about your C programs
</ul>
<br>
<b>Note:</b> these are <i>not</i> the same goals as COMP2121
<p><hr><p>
<table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><span class='heading'>Course Context</span></td><td align='right'><small>9/74</small></td></tr></table>
<p>
<br>
<p><div class='center'>
<img alt="[Diagram:Pics/intro/pre-reqs-small.png]" src="Pics/intro/pre-reqs-small.png">
</div><p>
<p><hr><p>
<table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><span class='heading'>Themes</span></td><td align='right'><small>10/74</small></td></tr></table>
<p>
Major themes ...
<ol>
<li> components of modern computer systems
<li> how C programs execute <small>(at the machine level)</small>
<li> how to write (MIPS) assembly language
<li> Unix/Linux system-level programming
<li> how operating systems and networks are structured
<li> introduction to concurrency, concurrent programming
</ol>
<br>
Goal: you are able to understand execution of software in detail
<p><hr><p>
<table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><span class='heading'>Detailed Topics</span></td><td align='right'><small>11/74</small></td></tr></table>
<p>
<ul>
<li> Processors
<ul>
<li> data representation, instruction set
<li> <em>assembler programming</em>
</ul>
<li> Program execution <small>(mapping C to assembler)</small>
<ul>
<li> memory layout: stack, heap, code
<li> control structures, function calls
</ul>
<li> Operating system architecture
<ul>
<li> memory, cache, devices, i/o, interrupts
<li> virtual memory, processes, file systems
</ul>
<li> Concurrency
<ul>
<li> parallelism, synchronisation, coordination
</ul>
<li> Network architecture
</ul>
<p><hr><p>
<table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><span class='heading'>Textbook</span></td><td align='right'><small>12/74</small></td></tr></table>
<p>
There is no prescribed textbook
<p>
Material has been drawn from:
<ul>
<li> "Introduction to Computing Systems: <br>
	from bits and gates to C and beyond", <br>
    Patt and Patel
<li> "From NAND to Tetris: <br>
	Building a modern computer system from first principles", <br>
	Nisan and Schocken
<li> COMP2121 Course Web Site, Parameswaran and Guo
</ul>
Note: always give credit to your sources
<p><hr><p>
<table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><span class='cont'>... Textbook</span></td><td align='right'><small>13/74</small></td></tr></table>
<p>
<table>
<td><img src="Pics/intro/csapp-small.jpg"></td>
<td>&nbsp;&nbsp;&nbsp;</td>
<td>
Recommended reference ...
<ul>
<li> <em>Computer Systems:<br> A Programmer's Perspective</em>, <br>
	Bryant and O'Halloren
<li> covers most topics, and quite well
<li> but uses a different machine code
</ul>
Available in UNSW Bookroom
</td>
<table>
<p><hr><p>
<table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><span class='heading'>Books vs Notes vs Slides</span></td><td align='right'><small>14/74</small></td></tr></table>
<p>
Textbooks ...
<ul>
<li> cover some parts of syllabus in great detail
</ul>
Course Notes ...
<ul>
<li> cover whole syllabus, but not in great detail
</ul>
Lecture Slides ...
<ul>
<li> summarize Course Notes and add exercises
</ul>
<p><hr><p>
<table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><span class='heading'>Systems and Tools</span></td><td align='right'><small>15/74</small></td></tr></table>
<p>
Prac work based on <em>Linux</em> tools
<ul>
<li> all tools available on the <em>CSE lab machines</em>
<li> can use <em>VLab</em> to connect to CSE from home
</ul>
Compilers: <large><code>gcc</code></large> &nbsp;<small>(also <large><code>dcc</code></large> on CSE machines)</small>
<p>
Assembly language: &nbsp;MIPS&nbsp; on &nbsp;<large><code>QtSpim</code></large> &nbsp;<small>(also <large><code>xspim</code></large> in CSE)</small>
<p>
Use your own favourite text editor &nbsp; <small>( I use <tt>vim</tt> )</small>
<p>
Other tools: &nbsp;&nbsp;<large><code>make</code></large>, &nbsp;&nbsp;<large><font color="#008800"><b><code>gdb</code></b></font></large>, &nbsp;&nbsp;<large><font color="#008800"><b><code>man</code></b></font></large>, &nbsp;&nbsp;<large><code>bc -l</code></large>
<p>
Learn to love the <em>shell</em> and command-line ... very useful
<p><hr><p>
<table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><span class='heading'>Classes</span></td><td align='right'><small>16/74</small></td></tr></table>
<p>
Lectures ...
<ul>
<li> 4 hours/week for 9 Weeks &nbsp; <small>(a la UNSW3+)</small>
<li> all lectures will be video'd (Echo360 <i>and</i> YouTube)
</ul>
Tutorials ...
<ul>
<li> 10 Weeks, 1 hour tute, followed by 2-hour lab
<li> explore lecture material via exercises
</ul>
Labs ...
<ul>
<li> small(ish) implementation tasks, done in pairs
<li> give skills practice <small>(leading on to assignments/exam)</small>
</ul>
<p><hr><p>
<table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><span class='cont'>... Classes</span></td><td align='right'><small>17/74</small></td></tr></table>
<p>
Public Holidays: Friday Week 5, Wednesday Week 8
<p>
Fortunately, public holidays don't clobber lecture slots
<p>
BUT if you have tute/lab on Friday or Wednesday
<ul>
<li> go to a different tute in that week
<li> go to a different lab if you need help
<li> submit lab by next Sunday, get your tutor to assess
</ul>
<p><hr><p>
<table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><span class='heading'>Assessments</span></td><td align='right'><small>18/74</small></td></tr></table>
<p>
<em>Lab exercises</em> contribute 10% to overall mark.
<p>
Ideally, the lab exercise for Week X must be
<ul>
<li> submitted before Sunday at end of week X
<li> demonstrated to tutor <i>during</i> Week X lab <br>
   OR, demonstrated <i>at the start of</i> Week X+1 lab
<li> aim of demo is to get feedback on design and style
</ul>
Late submissions will get <font color='#009900'>feedback</font> and <font color='#996600'>reduced mark</font>.
<p>
Exceptionally good submissions can get bonus (A+)
<p>
Total mark for labs can be &gt; 10 &nbsp; <small>(capped at 11)</small>.
<p><hr><p>
<table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><span class='cont'>... Assessments</span></td><td align='right'><small>19/74</small></td></tr></table>
<p>
Two <em>assignments</em> ...
<ul>
<li> Ass1: Assembly Language, &nbsp; weeks 3-6, &nbsp; 9 marks
<li> Ass2: C Programming, &nbsp; weeks 7-10, &nbsp; 11 marks
<li> both assignments are completed <em>individually</em>
<li> can be completed on your own machine
<ul>
<li> but you <i>must</i> test on the CSE machines before you submit
</ul>
</ul>
Late penalty: 1% off max mark for each hour late
<br>&nbsp;<p>
Good time management avoids late penalties
<p><hr><p>
<table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><span class='heading'>Quizzes</span></td><td align='right'><small>20/74</small></td></tr></table>
<p>
Five small online quizzes ...
<ul>
<li> 3-4 questions, multiple-choice format
<li> primarily for review of recent topics
<li> taken in your own time <small>(via Webcms3)</small>
</ul>
Contribute 10% towards final mark.
<p>
Starting this week ... C revision quiz
<p>
Then in weeks 2, 4, 6, 8, 10
<p>
Each quiz due before Sunday 11:59pm at end of week
<p><hr><p>
<table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><span class='heading'>Blogs</span></td><td align='right'><small>21/74</small></td></tr></table>
<p>
Keep a blog about what you're learning
<ul>
<li> write it at least weekly
<li> reflect on and plan your learning
</ul>
Bonus up to 1 mark if
<ul>
<li> you maintain regularly (weekly)
<li> what you write is interesting
</ul>
<p><hr><p>
<table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><span class='heading'>Misconduct</span></td><td align='right'><small>22/74</small></td></tr></table>
<p>
<div class='center'>
E.g. plagiarism, contracting, trolling, harassment, ...
</div>
<p><div class='center'>
<img alt="[Diagram:Pics/intro/noose1-small.jpg]" src="Pics/intro/noose1-small.jpg">
</div><p>
<div class='center'>
Just Don't Do it
</div>
<p><hr><p>
<table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><span class='heading'>Final Exam</span></td><td align='right'><small>23/74</small></td></tr></table>
<p>
3-hour on-line <s>torture</s> exam during the exam period.
<p>
Held in CSE labs &nbsp; <small>(must know lab environment)</small>
<p>
On-line documentation available in exam:
<ul>
<li> MIPS / QtSpim / C quick reference guides
<li> Unix Programmers Manual (<tt>man</tt>) &nbsp;<small>(very handy)</small>
</ul>
Format:
<ul>
<li> some programming exercises &nbsp; (Prac)
<li> some descriptive/analytical questions &nbsp; (Theory)
</ul>
How to pass? &nbsp; Practice, practice, practice, ... 
<p><hr><p>
<table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><span class='heading'>Course Assessment</span></td><td align='right'><small>24/74</small></td></tr></table>
<p>
<pre>
CourseWorkMark = QuizMark + LabMark + Ass1Mark + Ass2Mark
                                                   <span>(out of 40)</span>
ExamPracMark   = marks for prac questions on final exam
                                                   <span>(out of 30)</span>
ExamTheoryMark = marks for written questions on final exam
                                                   <span>(out of 30)</span>
ExamMark       = ExamPracMark + ExamTheoryMark     <span>(out of 60)</span>

ExamOK         = ExamMark &geq; 24/60                 <span>(true/false)</span>

FinalMark      = CourseWorkMark + ExamMark        <span>(out of 100)</span>

FinalGrade     = UF, if !ExamOK &amp;&amp; FinalMark &geq; 50
               = FL, if FinalMark &lt; 50/100 
               = PS, if 50/100 &leq; FinalMark < 65/100 
               = CR, if 65/100 &leq; FinalMark < 75/100 
               = DN, if 75/100 &leq; FinalMark < 85/100 
               = HD, if FinalMark &geq; 85/100   
</pre>
<p><hr><p>
<table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><span class='heading'>Supplementary Exams</span></td><td align='right'><small>25/74</small></td></tr></table>
<p>
Supplementary Exams are available to students who
<ul>
<li> do <em>not</em> attend the final exam
<li> have a documented reason for not attending
</ul>
Sympathy Supp Exams are available to students who
<ul>
<li> have <large><code>(ExamOK &amp;&amp; 47 &leq; FinalMark &lt; 50)</code></large>
</ul>
Passing a Sympathy Supp gives you max 50% overall
<p><hr><p>
<table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><span class='heading'>Summary</span></td><td align='right'><small>26/74</small></td></tr></table>
<p>
The goal is for you to become a better programmer
<ul>
<li> more confident in your own ability
<li> with an expanded set of tools to draw on
<li> a deeper understanding of "run-time" behaviour
<li> able to view software from systems-level perspective
<li> producing better engineered software
<li> ultimately, enjoying the programming process more
</ul>
<p><hr><p>
<table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><span class='section'>Computer Systems</span></td><td align='right'></td></tr></table>
<p>
<p><hr><p>
<table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><span class='heading'>Some History</span></td><td align='right'><small>28/74</small></td></tr></table>
<p>
A potted history of "computer systems" ...
<ul>
<li> 1613 ... first use of the word "computer" <br>
	<small>(meaning "a person who performs computations")</small>
<li> 1800's ... Babbage's mechanical computers <br>
	<small>(Analytical Engine and Difference Engine, with Ada Lovelace)</small>
<li> 1936 ... Zuse's Z1 electro-mechanical computer <br>
	<small>(first binary programmable computer)</small>
<li> 1943 ... Eckert/Mauchley's ENIAC <br>
	<small>(first fully functional electric digital computer ... 18000 valves)</small>
<li> 1949 ... EDSAC and Manchester Mark 1 <br>
	<small>(first generation stored program computers ... valves)</small>
<li> 1955 ... Whirlwhind at MIT <br>
	<small>(first digital computer with magnetic core RAM)</small>
<li> 1960 ... Digital Equipment Corporation PDP-1 <br>
	<small>(first mini-computer ... recognisable as "modern" computer)</small>
<li> 1971 ... Intel 4004 &nbsp; <small>(first microprocessor)</small>
</ul>
From: <a href="https://www.computerhope.com/issues/ch000984.htm">When was the first computer invented?</a>
<p><hr><p>
<table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><span class='cont'>... Some History</span></td><td align='right'><small>29/74</small></td></tr></table>
<p>
ENIAC ...
<p>
<p><div class='center'>
<img alt="[Diagram:Pics/system/eniac-small.jpg]" src="Pics/system/eniac-small.jpg">
</div><p>
<p><hr><p>
<table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><span class='cont'>... Some History</span></td><td align='right'><small>30/74</small></td></tr></table>
<p>
Whirlwind ...
<p>
<p><div class='center'>
<img alt="[Diagram:Pics/system/whirlwind-small.jpg]" src="Pics/system/whirlwind-small.jpg">
</div><p>
<p><hr><p>
<table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><span class='heading'>Computer Systems</span></td><td align='right'><small>31/74</small></td></tr></table>
<p>
Component view of typical modern computer system
<p>
<p><div class='center'>
<img alt="[Diagram:Pics/system/components-small.png]" src="Pics/system/components-small.png">
</div><p>
<p><hr><p>
<table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><span class='heading'>Processor</span></td><td align='right'><small>32/74</small></td></tr></table>
<p>
Modern processors provide
<ul>
<li> control, arithmetic, logic, bit operators
<li> relatively small set of simple instructions
<li> small amount of very fast storage (registers)
<li> small number of control registers (e.g. PC)
<li> fast fetch-decode-execute cycle (ns)
<li> access to system bus to communicate with other components
<li> all integrated on a single chip
</ul>
<small>We do not consider multi-core CPUs in this course</small>
<p><hr><p>
<table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><span class='heading'>Storage</span></td><td align='right'><small>33/74</small></td></tr></table>
<p>
Memory (main memory) consists of
<ul>
<li> very large random-addressable array of bytes
<li> can fetch single bytes into CPU registers
<li> can fetch multi-byte chunks into CPU (e.g. 4-byte int)
<li> typically: access time 70 ns, size 64 GB
</ul>
Disk storage consist of
<ul>
<li> very very large block-oriented storage 
<li> often on spinning disk, fetching 512B-4KB per request
<li> typically: access time 30 ms, size 8 TB
<li> nowadays, SSD: access time 0.8ms, size 1GB
</ul>
<p><hr><p>
<table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><span class='cont'>... Storage</span></td><td align='right'><small>34/74</small></td></tr></table>
<p>
Run-time memory usage depends on language processor.
<p>
How typical C compiler uses the memory:
<p><div class='center'>
<img alt="[Diagram:Pics/memory/regions-small.png]" src="Pics/memory/regions-small.png">
</div><p>
<p><hr><p>
<table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><span class='heading'>Computer System Layers</span></td><td align='right'><small>35/74</small></td></tr></table>
<p>
View of software layers in typical computer system
<p>
<p><div class='center'>
<img alt="[Diagram:Pics/system/layers-small.png]" src="Pics/system/layers-small.png">
</div><p>
<p><hr><p>
<table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><span class='heading'>C Program Life-cycle</span></td><td align='right'><small>36/74</small></td></tr></table>
<p>
Your C programs start as text
<ul>
<li> well-designed, readable, maintainable, ...
</ul>
Ultimately they execute on a CPU as machine code
<ul>
<li> efficiently producing correct results
<li> handling error conditions robustly
<li> utlising services of underlying operating system
</ul>
<br>
How to map from C source code to machine code?
<p>
How to make one C program run on different machine architectures?
<p><hr><p>
<table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><span class='cont'>... C Program Life-cycle</span></td><td align='right'><small>37/74</small></td></tr></table>
<p>
From source code to machine code ...
<p>
<p><div class='center'>
<img alt="[Diagram:Pics/compile/compilation-small.png]" src="Pics/compile/compilation-small.png">
</div><p>
<p><hr><p>
<table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><span class='heading'>History of C Compilers</span></td><td align='right'><small>38/74</small></td></tr></table>
<p>
Milestones in C history
<ul>
<li> <large><code>cc</code></large> ... original compiler by Dennis Ricthie (1971)
<li> <large><code>gcc</code></large> ... open source compiler by Richard Stallman et al (1987)
<li> <large><code>gcc</code></large> 2.0 ... added C++ compilation (1992)
<li> <large><code>clang</code></large> ... gcc replacement by Apple et al (2007)
<li> <large><code>dcc</code></large> ... Python wrapper on <large><code>clang</code></large> by Andrew Taylor (2012?)
<ul>
<li> augments error messages to be more helpful to novices
<li> incorporates useful run-time checking to help debugging
</ul>
</ul>
<p><hr><p>
<table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><span class='section'>C Revisited</span></td><td align='right'></td></tr></table>
<p>
<p><hr><p>
<table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><span class='heading'>What (I assume) You Know</span></td><td align='right'><small>40/74</small></td></tr></table>
<p>
Given a problem specification ...
<ul>
<li> design an algorithmic solution
<li> describe your solution in C code, using ...
<ul>
<li> variables, assignment, tests (<large><code>==</code></large>, <large><code>!</code></large>, <large><code>&lt;=</code></large>, <large><code>&&</code></b></font></large>, etc)
<li> <large><code>if</code></large>, <large><code>while</code></large>, <large><code>for</code></large>, <large><code>break</code></large>, <large><code>scanf()</code></large>, <large><code>printf()</code></large>
<li> functions, <large><code>return</code></large>, prototypes, <large><code>*.h</code></large>, <large><code>*.c</code></large>
<li> arrays, files, structs, pointers, <large><code>malloc()</code></large>, <large><code>free()</code></large>
</ul>
</ul>
I don't assume that you know ...
<ul>
<li> linked structures, ADTs, sorting, <em>recursion</em>, <em>bit operations</em>
</ul>
<p><hr><p>
<table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><span class='heading'>Type Definitions</span></td><td align='right'><small>41/74</small></td></tr></table>
<p>
Reminder: you can give a name to a C type definition e.g.
<p><pre>
typedef int Integer;
typedef long long int BigInt;
typedef unsigned char Byte;
typedef struct { int x; int y; } Coord;
</pre><p>
and then use the name instead of the type definition e.g.
<p><pre>
Byte  byte;         <comment>// one 8-bit variable</comment>
Coord here, there;  <comment>// two Coord variables</comment>
</pre><p>
<p><hr><p>
<table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><span class='heading'>Assignment as Expression</span></td><td align='right'><small>42/74</small></td></tr></table>
<p>
Assignments can be treated as expressions returning a value
<p><pre>
x = 5;          <comment>// returns 5</comment>
</pre><p>
Can be useful
<p><pre>
x = y = z = 0;  <comment>// equiv to x = (y = (z = 0))</comment>
</pre><p>
Can be dangerous
<p><pre>
if (x = 0)      <comment>// "test" always fails</comment>
</pre><p>
<p><hr><p>
<table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><span class='cont'>... Assignment as Expression</span></td><td align='right'><small>43/74</small></td></tr></table>
<p>
Assignment-as-expression often used to simplify loops, e.g.
<p><pre>
<comment>// read stdin one char at-a-time</comment>
while ((ch = getchar()) != EOF) {
   <comment>// do something with ch</comment>
}
</pre><p>
rather than
<p><pre>
ch = getchar();
while (ch != EOF) {
   <comment>// do something with ch</comment>
   ch = getchar();
}
</pre><p>
<p><hr><p>
<table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><span class='heading'>Ignoring Expression Results</span></td><td align='right'><small>44/74</small></td></tr></table>
<p>
We usually ignore the value returned by an assignment.
<p>
Some C functions return a result which is often ignored, e.g.
<p><pre>
int x = 123, y = 42;
printf("%d %d\n", x, y);
</pre><p>
<large><code>printf()</code></large> returns the number of characters printed.
<p>&nbsp;<p>
<b>Exercise:</b> what value does the above <large><code>printf()</code></large> return?
<p>
Choose answer at &nbsp; <em>www.zeetings.com/jas1/0004-2402-0001</em>
<p><hr><p>
<table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><span class='cont'>... Ignoring Expression Results</span></td><td align='right'><small>45/74</small></td></tr></table>
<p>
Return values not related to function semantics
<ul>
<li> are typically success/failure status
</ul>
E.g. <large><code>main()</code></large> returns zero (success) and non-zero (error)
<p>
Ignored return error statuses (stati?) are generally
<ul>
<li> extreemly unlikely to occur
<li> not fatal if the failure occurs
</ul>
&nbsp;<br>
Note: <large><code>errno</code></large> global variable and <large><code>perror()</code></large> function
<p><hr><p>
<table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><span class='heading'>Fine Control</span></td><td align='right'><small>46/74</small></td></tr></table>
<p>
<large><code>break</code></large> and <large><code>continue</code></large> provide fine loop control
<ul>
<li> <large><code>break</code></large> exits the innermost enclosing loop
<li> <large><code>continue</code></large> goes directly to the next iteration
</ul>
Above are not strictly needed in programming
<ul>
<li> same effect can be achieved using <large><code>if</code></large>s inside loop
</ul>
Using them is sometimes considered "bad style"
<ul>
<li> but, used carefully, can make code easier to understand
</ul>
<p><hr><p>
<table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><span class='cont'>... Fine Control</span></td><td align='right'><small>47/74</small></td></tr></table>
<p>
Example: <small>scan <large><code>a[N]</code></large>, stop on zero or at end, ignore negative values</small>
<p><pre>
for (i = 0; i < N; i++) {
   if (a[i] == 0) break;
   if (a[i] < 0) continue;
   sum += a[i];
}

<comment>/* vs */</comment>

for (i = 0; i < N && a[i] != 0; i++) {
   if (a[i] > 0) sum += a[i];
}
</pre><p>
<p><hr><p>
<table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><span class='heading'>Fine Function Control</span></td><td align='right'><small>48/74</small></td></tr></table>
<p>
<large><code>return</code></large> returns the result of a function
<p>
Good style says "have a single <large><code>return</code></large> at end"
<p>
However ...
<ul>
<li> a function can contain several <large><code>return</code></large>s
<li> each can capture a specific condition to complete function
</ul>
Used carefully, can make functions easier to understand
<p><hr><p>
<table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><span class='heading'>Fine Program Control</span></td><td align='right'><small>49/74</small></td></tr></table>
<p>
Good style says "Program returns at end of main()"
<p>
However, exceptional conditions may require early exit
<p>
<large><code>exit()</code></large> terminates program with return code
<p>
Can be used from anywhere in program &nbsp;<small>(even deeply nested functions)</small>
<p>
<large><code>assert()</code></large> can also be used to trigger program exit
<p>
<p><pre>
assert(<i>Condition</i>);

<comment>/* similar to */</comment>

if (!<i>Condition</i>) exit(1);
</pre><p>
<p><hr><p>
<table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><span class='heading'>Stacks, Queues, PriorityQs</span></td><td align='right'><small>50/74</small></td></tr></table>
<p>
Computer systems frequently make use of:
<ul>
<li> <em>stacks</em> ... last-in-first-out lists
<small>
<ul>
<li> e.g. used to represent function local variables
</ul>
</small>
<li> <em>queues</em> ... first-in-first-out lists
<small>
<ul>
<li> e.g. used to ensure fair access to a resource
</ul>
</small>
<li> <em>priority queues</em> ... highest-priority-out lists
<small>
<ul>
<li> e.g. used to represent weighted lists of processes
</ul>
</small>
</ul>
<p><hr><p>
<table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><span class='cont'>... Stacks, Queues, PriorityQs</span></td><td align='right'><small>51/74</small></td></tr></table>
<p>
All of these data structures have
<ul>
<li> a sequence of items
<li> an operation to <em>insert</em> an item into the sequence
<li> an operation to <em>remove</em> an item from the sequence
</ul>
Example stack/queue/priorityQ structures
<p><div class='center'>
<img alt="[Diagram:Pics/clang/sqp-struct-small.png]" src="Pics/clang/sqp-struct-small.png">
</div><p>
<p><hr><p>
<table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><span class='cont'>... Stacks, Queues, PriorityQs</span></td><td align='right'><small>52/74</small></td></tr></table>
<p>
Data structures differ in
<ul>
<li> stack ... <em>insert</em> adds on <em>top</em>, &nbsp;<em>removes</em> from <em>top</em>
<li> queue ... <em>insert</em> adds at <em>tail</em>, &nbsp;<em>removes</em> from <em>head</em>
<li> priorityQ ... <em>inserts</em> in priority <em>order</em>, &nbsp;<em>removes</em> from <em>head</em>
</ul>
Example stack/queue/priorityQ structures
<p><div class='center'>
<img alt="[Diagram:Pics/clang/sqp-struct-small.png]" src="Pics/clang/sqp-struct-small.png">
</div><p>
<p><hr><p>
<table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><span class='heading'>Example Stack/Queue/PriorityQ Usage</span></td><td align='right'><small>53/74</small></td></tr></table>
<p>
Starting from data containing one item, insert 3
<br>&nbsp;
<p><div class='center'>
<img alt="[Diagram:Pics/clang/sqp1-small.png]" src="Pics/clang/sqp1-small.png">
</div><p>
<p><hr><p>
<table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><span class='cont'>... Example Stack/Queue/PriorityQ Usage</span></td><td align='right'><small>54/74</small></td></tr></table>
<p>
Then insert 6
<br>&nbsp;
<p><div class='center'>
<img alt="[Diagram:Pics/clang/sqp2-small.png]" src="Pics/clang/sqp2-small.png">
</div><p>
<p><hr><p>
<table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><span class='cont'>... Example Stack/Queue/PriorityQ Usage</span></td><td align='right'><small>55/74</small></td></tr></table>
<p>
Then insert 2
<br>&nbsp;
<p><div class='center'>
<img alt="[Diagram:Pics/clang/sqp3-small.png]" src="Pics/clang/sqp3-small.png">
</div><p>
<p><hr><p>
<table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><span class='cont'>... Example Stack/Queue/PriorityQ Usage</span></td><td align='right'><small>56/74</small></td></tr></table>
<p>
Then remove item
<br>&nbsp;
<p><div class='center'>
<img alt="[Diagram:Pics/clang/sqp4-small.png]" src="Pics/clang/sqp4-small.png">
</div><p>
<p><hr><p>
<table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><span class='cont'>... Example Stack/Queue/PriorityQ Usage</span></td><td align='right'><small>57/74</small></td></tr></table>
<p>
Then insert 4
<br>&nbsp;
<p><div class='center'>
<img alt="[Diagram:Pics/clang/sqp5-small.png]" src="Pics/clang/sqp5-small.png">
</div><p>
<p><hr><p>
<table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><span class='cont'>... Example Stack/Queue/PriorityQ Usage</span></td><td align='right'><small>58/74</small></td></tr></table>
<p>
Then remove item
<br>&nbsp;
<p><div class='center'>
<img alt="[Diagram:Pics/clang/sqp6-small.png]" src="Pics/clang/sqp6-small.png">
</div><p>
<p><hr><p>
<table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><span class='cont'>... Example Stack/Queue/PriorityQ Usage</span></td><td align='right'><small>59/74</small></td></tr></table>
<p>
Then remove item
<br>&nbsp;
<p><div class='center'>
<img alt="[Diagram:Pics/clang/sqp7-small.png]" src="Pics/clang/sqp7-small.png">
</div><p>
<p><hr><p>
<table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><span class='heading'>Stack Data Structure</span></td><td align='right'><small>60/74</small></td></tr></table>
<p>
Stack: Last-in, First-out (LIFO) protocol
<ul>
<li> insert operation called <large><code>push()</code></large>
<li> remove operation called <large><code>pop()</code></large>
<li> has a top <small>(last item added)</small> and a size
</ul>
Stack interface:
<p><pre>
typedef struct _stack { ... } Stack;
void initStack(Stack *s);
int  pushStack(Stack *s, Item val);
Item popStack(Stack *s);
int  isEmptyStack(Stack s);
...
</pre><p>
<p><hr><p>
<table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><span class='heading'>Example Stack Client</span></td><td align='right'><small>61/74</small></td></tr></table>
<p>
A program to use a stack of <large><code>int</code></large> values
<p><pre><small>
#include &lt;stdio.h&gt;
#include "Stack.h"
int main(void)
{
   Stack myStack; <comment>// uninitialized Stack</comment>
   int   x;       <comment>// variable to hold inputs</comment>

   initStack(&myStack);
   while (scanf("%d",&x) == 1) {
      if (!pushStack(&myStack, x)) break;
   }
   while (!isEmptyStack(myStack)) {
      printf("%d\n", popStack(&myStack));
   }
   return 0;
}
</small></pre><p>
<p><hr><p>
<table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><span class='heading'>Queue Data Structure</span></td><td align='right'><small>62/74</small></td></tr></table>
<p>
Queue: First-in, First-out (FIFO) protocol
<ul>
<li> insert operation called <large><code>enter</code></large> (or <large><code>enqueue()</code></large>)
<li> remove operation called <large><code>leave</code></large> (or <large><code>dequeue()</code></large>)
<li> has a head <small>(first item added)</small>, a tail <small>(last item added)</small>, and a size
</ul>
Queue interface:
<p><pre>
typedef struct _queue { ... } Queue;
void initQueue(Queue *q);
int  enterQueue(Queue *q, Item val);
Item leaveQueue(Queue *q);
int  isEmptyQueue(Queue q);
...
</pre><p>
Implementation covered in tute exercises.
<p><hr><p>
<table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><span class='heading'>Priority Queue Data Structure</span></td><td align='right'><small>63/74</small></td></tr></table>
<p>
Queue: Highest-priority-out protocol
<ul>
<li> insert operation called <large><code>enter</code></large> (or <large><code>enqueue()</code></large>)
<li> remove operation called <large><code>leave</code></large> (or <large><code>dequeue()</code></large>)
<li> has a head <small>(next for removal)</small>, a tail <small>(lowest-priority)</small>, and a size
</ul>
Priority Queue interface:
<p><pre>
typedef struct _priorityq { ... } PriorityQ;
void initPriorityQ(PriorityQ *q);
int  enterPriorityQ(PriorityQ *q, Item val);
Item leavePriorityQ(PriorityQ *q);
int  isEmptyPriorityQ(PriorityQ q);
...
</pre><p>
Implementation left as an exercise for the reader.
<p><hr><p>
<table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><span class='section'>Bit Manipulation</span></td><td align='right'></td></tr></table>
<p>
<p><hr><p>
<table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><span class='heading'>Bits in Bytes in Words</span></td><td align='right'><small>65/74</small></td></tr></table>
<p>
Values that we normally treat as atomic can be viewed as bits, e.g.
<ul>
<li> <large><code>char</code></large> = 1 byte = 8 bits
	&nbsp;&nbsp; <small>(<large><code>'a'</code></large> is <large><code>01100001</code></large>)</small>
<li> <large><code>short</code></large> = 2 bytes = 16 bits
	&nbsp;&nbsp; <small>(<large><code>42</code></large> is <large><code>0000000000101010</code></large>)</small>
<li> <large><code>int</code></large> = 4 bytes = 32 bits
	&nbsp;&nbsp; <small>(<large><code>42</code></large> is <large><code>0000000000</code></large>...<large><code>0000101010</code></large>)</small>
<li> <large><code>double</code></large> = 8 bytes = 64 bits
</ul>
The above are common sizes and don't apply on all hardware <br>
<small>(e.g. <large><code>sizeof(int)</code></large> might be 16 or 64 bits, <large><code>sizeof(double)</code></large> might be 32 bits)</small>
<p>
C provides a set of operators that act bit-by-bit on pairs of bytes.
<p>
E.g. <large><code>(10101010 <font color='#CC0000'>&</font> 11110000)</code></large> yields <large><code>10100000</code></large> &nbsp; <small>(bitwise AND)</small>
<p>
C bitwise operators: &nbsp;&nbsp; <large><code>&   &nbsp;|   &nbsp;^   &nbsp;~   &nbsp;&lt;&lt;   &nbsp;>&gt;</code></large>
<p><hr><p>
<table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><span class='heading'>Binary Constants</span></td><td align='right'><small>66/74</small></td></tr></table>
<p>
C does not have a way of directly writing binary numbers
<p>
Can write numbers in decimal, hexadecimal and octal.
<p>
In hexadecimal, each digit represents 4 bits
<p><pre>
   0100 1000 1111 1010 1011 1100 1001 0111
0x   4    8    F    A    B    C    9    7
</pre><p>
In octal, each digit represents 3 bits
<p><pre>
   01 001 000 111 110 101 011 110 010 010 111
0   1  1   0   7   6   5   3   6   2   2   7
</pre><p>
<p><hr><p>
<table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><span class='heading'>Bitwise AND</span></td><td align='right'><small>67/74</small></td></tr></table>
<p>
The <large><code>&</code></large> operator
<ul>
<li> takes two values (1,2,4,8 bytes), treats as sequence of bits
<li> performs logical AND on each corresponding pair of bits
<li> result contains same number of bits as inputs
</ul>
Example:
<p><pre>
  00100111           AND | 0  1
& 11100011           ----|-----
  --------             0 | 0  0
  00100011             1 | 0  1
</pre><p>
Used for e.g. checking whether a bit is set
<p><hr><p>
<table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><span class='heading'>Bitwise OR</span></td><td align='right'><small>68/74</small></td></tr></table>
<p>
The <large><code>|</code></large> operator
<ul>
<li> takes two values (1,2,4,8 bytes), treats as sequence of bits
<li> performs logical OR on each corresponding pair of bits
<li> result contains same number of bits as inputs
</ul>
Example:
<p><pre>
  00100111            OR | 0  1
| 11100011           ----|-----
  --------             0 | 0  1
  11100111             1 | 1  1
</pre><p>
Used for e.g. ensuring that a bit is set
<p><hr><p>
<table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><span class='heading'>Flag-bits</span></td><td align='right'><small>69/74</small></td></tr></table>
<p>
Consider file permissions in the Unix file system
<p>
Each file has three sets of "flags" defining it permissions
<p><pre>
$ <b>ls -l odd.c</b>
-<font color='#CC0000'>rwx</font><font color='#0000CC'>rw-</font><font color='#009900'>r--</font>  1 jas  <i>group</i>  486 26 Jul 23:22 odd.c
</pre><p>
<ul>
<li> <font color='#CC0000'><large><code>rwx</code></large></font> gives permissions for the owner of the file
<li> <font color='#0000CC'><large><code>rw-</code></large></font> gives permissions for group members
<li> <font color='#009900'><large><code>r--</code></large></font> gives permissions for everyone else
</ul>
How to represent these? Efficiently?
<p><hr><p>
<table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><span class='cont'>... Flag-bits</span></td><td align='right'><small>70/74</small></td></tr></table>
<p>
One possible representation:
<p><pre>
typedef char Permissions[10];       <comment>// e.g. "rwxrw-r--"</comment>
</pre><p>
Another possible representation:
<p><pre>
typedef int Permissions[9];   <comment>//e.g. {1,1,1,1,1,0,1,0,0}</comment>
</pre><p>
Compact representation:
<p><pre>
typedef unsigned short Permissions;  <comment>//e.g. 0764 or 0x1F4</comment>
</pre><p>
Last representation uses 1-bit per permission "flag"
<p><hr><p>
<table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><span class='heading'>Bitwise XOR</span></td><td align='right'><small>71/74</small></td></tr></table>
<p>
The <large><code>^</code></large> operator
<ul>
<li> takes two values (1,2,4,8 bytes), treats as sequence of bits
<li> performs logical XOR on each corresponding pair of bits
<li> result contains same number of bits as inputs
</ul>
Example:
<p><pre>
  00100111           XOR | 0  1
^ 11100011           ----|-----
  --------             0 | 0  1
  11000100             1 | 1  0
</pre><p>
Used in e.g. generating random numbers, building adder circuits
<p><hr><p>
<table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><span class='heading'>Bitwise NEG</span></td><td align='right'><small>72/74</small></td></tr></table>
<p>
The <large><code>~</code></large> operator
<ul>
<li> takes a single value (1,2,4,8 bytes), treats as sequence of bits
<li> performs logical negation of each bit
<li> result contains same number of bits as input
</ul>
Example:
<p><pre>
~ 00100111           NEG | 0  1
  --------           ----|-----
  11011000               | 1  0
</pre><p>
Used for e.g. creating useful bit patterns
<p><hr><p>
<table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><span class='heading'>Left Shift</span></td><td align='right'><small>73/74</small></td></tr></table>
<p>
The <large><code>&lt;&lt;</code></large> operator
<ul>
<li> takes a single value (1,2,4,8 bytes), treats as sequence of bits
<li> and a small positive integer <i>x</i>
<li> moves (shifts) each bit <i>x</i> positions to the left
<li> left-end bit vanishes; right-end bit replaced by zero
<li> result contains same number of bits as input
</ul>
Example:
<p><pre>
  00100111 &lt;&lt; 2      00100111 &lt;&lt; 8
  --------           --------
  10011100           00000000
</pre><p>
<p><hr><p>
<table width='100%' cellpadding='0'>
<tr valign='top'><td align='left'><span class='heading'>Right Shift</span></td><td align='right'><small>74/74</small></td></tr></table>
<p>
The <large><code>&gt;></code></large> operator
<ul>
<li> takes a single value (1,2,4,8 bytes), treats as sequence of bits
<li> and a small positive integer <i>x</i>
<li> moves (shifts) each bit <i>x</i> positions to the right
<li> right-end bit vanishes; left-end bit replaced by zero**
<li> result contains same number of bits as input
</ul>
Example:
<p><pre>
  00100111 >&gt; 2      00100111 >&gt; 8
  --------           --------
  00001001           00000000
</pre><p>
** if <large><code>signed</code></large> quantity, sign bit replaces left-end bit
<p><hr><p>
<small><small>Produced: 2 Apr 2018</small></small>
</body>
</html>
